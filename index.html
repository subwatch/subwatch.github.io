<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stop-Payment | Менеджер Підписок</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom scrollbar for a cleaner look */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1f2937;
        }
        ::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }
        /* Style for the date input placeholder */
        input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(0.8);
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 antialiased">

    <!-- User Profile -->
    <div id="userProfile" class="hidden absolute top-4 right-4 flex items-center space-x-3 z-10">
        <img id="userAvatar" class="h-10 w-10 rounded-full" src="" alt="User Avatar">
        <div>
            <p id="userName" class="text-sm font-medium text-white"></p>
            <button id="signOutBtn" class="text-xs text-gray-400 hover:text-white transition">Вийти</button>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container mx-auto max-w-2xl p-4 sm:p-6 md:p-8 min-h-screen">

        <!-- Header -->
        <header class="text-center mb-8 pt-12 sm:pt-0">
            <h1 class="text-4xl font-bold text-white tracking-tight">Stop-Payment</h1>
            <p class="text-gray-400 mt-2">Тримайте свої підписки під контролем.</p>
        </header>
        
        <!-- Login Container -->
        <div id="loginContainer" class="text-center mt-16">
            <h2 class="text-2xl font-semibold text-white mb-4">Вітаємо!</h2>
            <p class="text-gray-400 mb-8 max-w-md mx-auto">Увійдіть, щоб керувати своїми підписками та синхронізувати їх між усіма вашими пристроями.</p>
            <button id="signInBtn" class="bg-white text-gray-800 font-semibold py-3 px-6 rounded-lg shadow-lg flex items-center mx-auto hover:bg-gray-200 transition-colors">
                <svg class="w-6 h-6 mr-3" viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"></path><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"></path><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"></path><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"></path><path fill="none" d="M0 0h48v48H0z"></path></svg>
                Увійти через Google
            </button>
        </div>

        <!-- Main App Content (hidden until login) -->
        <div id="appContent" class="hidden">
            <!-- Add Subscription Button -->
            <div class="flex justify-center mb-8">
                <button id="openModalBtn" class="bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-indigo-500">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-2 -mt-1" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
                    </svg>
                    Додати Підписку
                </button>
            </div>
            
            <!-- Total Spending -->
            <div id="totalSpending" class="text-center mb-8 text-gray-400"></div>

            <!-- Subscriptions List -->
            <div id="subscriptionsList" class="space-y-4">
                <!-- Subscription items will be injected here by JS -->
            </div>

            <!-- Placeholder for empty state -->
            <div id="emptyState" class="hidden text-center py-12 px-6 bg-gray-800 rounded-lg mt-8">
                <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-12 w-12 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
                </svg>
                <h3 class="mt-2 text-lg font-medium text-white">Список підписок порожній</h3>
                <p class="mt-1 text-sm text-gray-400">Натисніть "Додати Підписку", щоб почати.</p>
            </div>
        </div>

    </div>

    <!-- Add/Edit Subscription Modal -->
    <div id="subscriptionModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-gray-800 rounded-2xl shadow-2xl p-6 sm:p-8 w-full max-w-md transform transition-all" id="modalContent">
            <h2 id="modalTitle" class="text-2xl font-bold text-white mb-6">Нова Підписка</h2>
            <form id="subscriptionForm">
                <input type="hidden" id="subscriptionId">
                <div class="space-y-5">
                    <div>
                        <label for="serviceName" class="block text-sm font-medium text-gray-300 mb-1">Назва сервісу</label>
                        <input type="text" id="serviceName" class="w-full bg-gray-700 border-gray-600 text-white rounded-lg px-4 py-2.5 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Напр. Netflix, Spotify" required>
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                        <div class="sm:col-span-2">
                            <label for="amount" class="block text-sm font-medium text-gray-300 mb-1">Сума</label>
                            <input type="number" id="amount" step="0.01" min="0" class="w-full bg-gray-700 border-gray-600 text-white rounded-lg px-4 py-2.5 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="10.99" required>
                        </div>
                        <div>
                            <label for="currency" class="block text-sm font-medium text-gray-300 mb-1">Валюта</label>
                            <select id="currency" class="w-full bg-gray-700 border-gray-600 text-white rounded-lg px-4 py-2.5 appearance-none focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                <option>UAH</option>
                                <option>USD</option>
                                <option>EUR</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label for="nextPaymentDate" class="block text-sm font-medium text-gray-300 mb-1">Дата наступного платежу</label>
                        <input type="date" id="nextPaymentDate" class="w-full bg-gray-700 border-gray-600 text-white rounded-lg px-4 py-2.5 focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                    </div>
                </div>
                <div class="mt-8 flex justify-end space-x-3">
                    <button type="button" id="closeModalBtn" class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-5 rounded-lg transition">Скасувати</button>
                    <button type="submit" class="bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-2 px-5 rounded-lg transition">Зберегти</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Custom Notification Alert -->
    <div id="notification" class="fixed bottom-5 right-5 bg-yellow-500 text-gray-900 p-4 rounded-lg shadow-lg z-50 hidden max-w-sm">
      <div class="flex items-start">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3 text-yellow-900" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
        </svg>
        <div id="notificationContent">
            <!-- Notification messages will be injected here -->
        </div>
      </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-gray-800 rounded-2xl shadow-2xl p-6 sm:p-8 w-full max-w-sm transform transition-all">
            <h3 class="text-lg font-medium leading-6 text-white" id="confirmModalTitle">Видалити підписку?</h3>
            <div class="mt-2">
                <p class="text-sm text-gray-400" id="confirmModalBody">Цю дію неможливо буде скасувати. Ви впевнені?</p>
            </div>
            <div class="mt-6 flex justify-end space-x-3">
                <button type="button" id="confirmCancelBtn" class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-5 rounded-lg transition">Скасувати</button>
                <button type="button" id="confirmDeleteBtn" class="bg-red-600 hover:bg-red-500 text-white font-bold py-2 px-5 rounded-lg transition">Видалити</button>
            </div>
        </div>
    </div>


    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, addDoc, doc, updateDoc, deleteDoc, query, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        document.addEventListener('DOMContentLoaded', () => {
            // DOM Elements
            const userProfile = document.getElementById('userProfile');
            const userAvatar = document.getElementById('userAvatar');
            const userName = document.getElementById('userName');
            const signOutBtn = document.getElementById('signOutBtn');
            const signInBtn = document.getElementById('signInBtn');
            const loginContainer = document.getElementById('loginContainer');
            const appContent = document.getElementById('appContent');
            
            const openModalBtn = document.getElementById('openModalBtn');
            const closeModalBtn = document.getElementById('closeModalBtn');
            const subscriptionModal = document.getElementById('subscriptionModal');
            const modalContent = document.getElementById('modalContent');
            const subscriptionForm = document.getElementById('subscriptionForm');
            const subscriptionsList = document.getElementById('subscriptionsList');
            const emptyState = document.getElementById('emptyState');
            const totalSpendingEl = document.getElementById('totalSpending');
            const notification = document.getElementById('notification');
            const notificationContent = document.getElementById('notificationContent');
            const confirmModal = document.getElementById('confirmModal');
            const confirmCancelBtn = document.getElementById('confirmCancelBtn');
            const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
            let subscriptionToDeleteId = null;

            // Form Fields
            const subscriptionIdField = document.getElementById('subscriptionId');
            const serviceNameField = document.getElementById('serviceName');
            const amountField = document.getElementById('amount');
            const currencyField = document.getElementById('currency');
            const nextPaymentDateField = document.getElementById('nextPaymentDate');
            const modalTitle = document.getElementById('modalTitle');
            
            // --- Firebase Setup ---
            const firebaseConfig = 
                apiKey: "AIzaSyAzw99mWK9lHlMpFpcJ31wrAsrtGZfxj_k",
                authDomain: "subwatch-subscription-re-567e2.firebaseapp.com",
                projectId: "subwatch-subscription-re-567e2",
                storageBucket: "subwatch-subscription-re-567e2.firebasestorage.app",
                messagingSenderId: "132090557441",
                appId: "1:132090557441:web:ac16dc7bc8c7bf4ddcbc00",
                measurementId: "G-01Z35NDF7P");
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
            let app, db, auth, userId, subscriptionsCollection;
            let unsubscribe; // To stop listener on logout
            
            setLogLevel('debug');

            // --- Data Management ---
            let subscriptions = [];

            async function initializeFirebase() {
                try {
                    app = initializeApp(firebaseConfig);
                    db = getFirestore(app);
                    auth = getAuth(app);

                    onAuthStateChanged(auth, (user) => {
                        if (user) {
                            // User is signed in
                            userId = user.uid;
                            console.log("Authenticated user:", userId);
                            updateUIForUser(user);
                            subscriptionsCollection = collection(db, `artifacts/${appId}/users/${userId}/subscriptions`);
                            listenForSubscriptions();
                        } else {
                            // User is signed out
                            console.log("User is signed out.");
                            updateUIForGuest();
                        }
                    });
                } catch (e) {
                    console.error("Firebase initialization failed:", e);
                }
            }

            const signInWithGoogle = async () => {
                const provider = new GoogleAuthProvider();
                try {
                    await signInWithPopup(auth, provider);
                } catch (error) {
                    console.error("Google Sign-In failed:", error);
                }
            };

            const signOutUser = async () => {
                try {
                    await signOut(auth);
                } catch (error) {
                    console.error("Sign-Out failed:", error);
                }
            };
            
            const updateUIForUser = (user) => {
                userProfile.classList.remove('hidden');
                appContent.classList.remove('hidden');
                loginContainer.classList.add('hidden');
                
                userAvatar.src = user.photoURL || 'https://placehold.co/40x40/64748b/ffffff?text=U';
                userName.textContent = user.displayName || 'Користувач';
            };
            
            const updateUIForGuest = () => {
                if (unsubscribe) unsubscribe(); // Detach the old listener
                subscriptions = [];
                renderSubscriptions(); // Clear the list
                userProfile.classList.add('hidden');
                appContent.classList.add('hidden');
                loginContainer.classList.remove('hidden');
            };

            const listenForSubscriptions = () => {
                if (!subscriptionsCollection) return;
                if (unsubscribe) unsubscribe(); // Detach any existing listener before creating a new one

                unsubscribe = onSnapshot(query(subscriptionsCollection), (snapshot) => {
                    subscriptions = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    renderSubscriptions();
                    checkNotifications();
                }, (error) => {
                    console.error("Error listening to subscriptions:", error);
                });
            };
            
            // --- UI Functions ---
            const renderSubscriptions = () => {
                subscriptionsList.innerHTML = '';
                
                if (subscriptions.length === 0) {
                    emptyState.classList.remove('hidden');
                    totalSpendingEl.classList.add('hidden');
                    return;
                }
                
                emptyState.classList.add('hidden');
                totalSpendingEl.classList.remove('hidden');

                subscriptions.sort((a, b) => {
                    const daysA = getDaysRemaining(a.nextPaymentDate);
                    const daysB = getDaysRemaining(b.nextPaymentDate);
                    return daysA - daysB;
                });

                let totalMonthlySpending = {};

                subscriptions.forEach(sub => {
                    if (!totalMonthlySpending[sub.currency]) {
                        totalMonthlySpending[sub.currency] = 0;
                    }
                    totalMonthlySpending[sub.currency] += parseFloat(sub.amount);

                    const daysRemaining = getDaysRemaining(sub.nextPaymentDate);
                    const { text, colorClass } = getDaysRemainingInfo(daysRemaining);
                    
                    const formattedDate = new Date(sub.nextPaymentDate).toLocaleDateString('uk-UA', { day: 'numeric', month: 'long', year: 'numeric' });
                    const currencySymbol = getCurrencySymbol(sub.currency);

                    const subElement = document.createElement('div');
                    subElement.className = `bg-gray-800 p-4 rounded-lg shadow-md flex items-center justify-between transition-transform transform hover:-translate-y-1 cursor-pointer`;
                    subElement.dataset.id = sub.id;
                    
                    subElement.innerHTML = `
                        <div class="flex items-center space-x-4">
                             <div class="w-2.5 h-16 rounded-full ${colorClass}"></div>
                             <div>
                                <p class="font-bold text-lg text-white">${sub.serviceName}</p>
                                <p class="text-sm text-gray-400">${formattedDate}</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-4">
                             <div class="text-right">
                                <p class="font-semibold text-lg text-white">${sub.amount} ${currencySymbol}</p>
                                <p class="text-xs font-medium ${getDaysRemainingInfo(daysRemaining).textColorClass}">${text}</p>
                            </div>
                            <button class="delete-btn text-gray-500 hover:text-red-500 transition p-2" data-id="${sub.id}">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" /></svg>
                            </button>
                        </div>
                    `;
                    subscriptionsList.appendChild(subElement);
                });
                
                renderTotalSpending(totalMonthlySpending);
            };
            
            const renderTotalSpending = (totals) => {
                 let totalText = "Загальні витрати на місяць: ";
                 const parts = Object.entries(totals).map(([currency, amount]) => {
                     return `<strong class="text-white">${amount.toFixed(2)} ${getCurrencySymbol(currency)}</strong>`;
                 });
                 if (parts.length === 0) {
                     totalSpendingEl.innerHTML = '';
                 } else {
                     totalSpendingEl.innerHTML = totalText + parts.join(' + ');
                 }
            };

            const checkNotifications = () => {
                const upcomingSubs = subscriptions.filter(sub => {
                    const days = getDaysRemaining(sub.nextPaymentDate);
                    return days >= 0 && days <= 3;
                });

                if (upcomingSubs.length > 0) {
                    notificationContent.innerHTML = upcomingSubs.map(sub => 
                        `<p class="mb-1"><strong>${sub.serviceName}</strong> - оплата через ${getDaysRemainingText(getDaysRemaining(sub.nextPaymentDate))}.</p>`
                    ).join('');
                    notification.classList.remove('hidden');
                    
                    setTimeout(() => {
                        notification.classList.add('hidden');
                    }, 8000);
                } else {
                    notification.classList.add('hidden');
                }
            };

            // --- Helper Functions ---
            const getDaysRemaining = (dateString) => {
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                const paymentDate = new Date(dateString);
                paymentDate.setHours(0,0,0,0);
                const diffTime = paymentDate - today;
                return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            };
            
            const getDaysRemainingText = (days) => {
                if (days < 0) return 'Протерміновано';
                if (days === 0) return 'Сьогодні';
                if (days === 1) return '1 день';
                if (days > 1 && days < 5) return `${days} дні`;
                return `${days} днів`;
            }

            const getDaysRemainingInfo = (days) => {
                let text = `Залишилось ${getDaysRemainingText(days)}`;
                let colorClass = 'bg-green-500';
                let textColorClass = 'text-green-400';

                if (days < 0) {
                    text = `Протерміновано ${getDaysRemainingText(Math.abs(days))}`;
                    colorClass = 'bg-red-500';
                    textColorClass = 'text-red-400';
                } else if (days <= 3) {
                    colorClass = 'bg-red-500';
                    textColorClass = 'text-red-400';
                } else if (days <= 7) {
                    colorClass = 'bg-yellow-500';
                    textColorClass = 'text-yellow-400';
                }
                return { text, colorClass, textColorClass };
            };

            const getCurrencySymbol = (currency) => {
                switch (currency) {
                    case 'UAH': return '₴';
                    case 'USD': return '$';
                    case 'EUR': return '€';
                    default: return '';
                }
            };

            // --- Modal Management ---
            const showModal = (isEdit = false, sub = null) => {
                subscriptionForm.reset();
                if (isEdit && sub) {
                    modalTitle.textContent = "Редагувати Підписку";
                    subscriptionIdField.value = sub.id;
                    serviceNameField.value = sub.serviceName;
                    amountField.value = sub.amount;
                    currencyField.value = sub.currency;
                    nextPaymentDateField.value = new Date(sub.nextPaymentDate).toISOString().split('T')[0];
                } else {
                    modalTitle.textContent = "Нова Підписка";
                    subscriptionIdField.value = '';
                    const today = new Date();
                    today.setDate(today.getDate() + 1);
                    nextPaymentDateField.value = today.toISOString().split('T')[0];
                }
                subscriptionModal.classList.remove('hidden');
                setTimeout(() => modalContent.classList.add('scale-100'), 10);
            };

            const hideModal = () => {
                modalContent.classList.remove('scale-100');
                subscriptionModal.classList.add('hidden');
            };

            const showConfirmModal = (id) => {
                subscriptionToDeleteId = id;
                confirmModal.classList.remove('hidden');
            };

            const hideConfirmModal = () => {
                subscriptionToDeleteId = null;
                confirmModal.classList.add('hidden');
            };

            // --- Event Listeners ---
            signInBtn.addEventListener('click', signInWithGoogle);
            signOutBtn.addEventListener('click', signOutUser);

            openModalBtn.addEventListener('click', () => showModal());
            closeModalBtn.addEventListener('click', hideModal);
            subscriptionModal.addEventListener('click', (e) => {
                if (e.target === subscriptionModal) hideModal();
            });

            subscriptionForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const id = subscriptionIdField.value;
                const subscriptionData = {
                    serviceName: serviceNameField.value.trim(),
                    amount: parseFloat(amountField.value),
                    currency: currencyField.value,
                    nextPaymentDate: nextPaymentDateField.value,
                };
                
                try {
                    if (id) {
                        const docRef = doc(db, `artifacts/${appId}/users/${userId}/subscriptions`, id);
                        await updateDoc(docRef, subscriptionData);
                    } else {
                        await addDoc(subscriptionsCollection, subscriptionData);
                    }
                    hideModal();
                } catch (error) {
                    console.error("Error saving subscription:", error);
                }
            });
            
            subscriptionsList.addEventListener('click', (e) => {
                const deleteButton = e.target.closest('.delete-btn');
                if (deleteButton) {
                    const id = deleteButton.dataset.id;
                    showConfirmModal(id);
                    return;
                }
                
                const card = e.target.closest('[data-id]');
                if (card) {
                    const subId = card.dataset.id;
                    const subToEdit = subscriptions.find(s => s.id == subId);
                    if (subToEdit) showModal(true, subToEdit);
                }
            });

            confirmCancelBtn.addEventListener('click', hideConfirmModal);
            confirmDeleteBtn.addEventListener('click', async () => {
                if (subscriptionToDeleteId) {
                    try {
                        const docRef = doc(db, `artifacts/${appId}/users/${userId}/subscriptions`, subscriptionToDeleteId);
                        await deleteDoc(docRef);
                    } catch (error) {
                        console.error("Error deleting subscription:", error);
                    } finally {
                        hideConfirmModal();
                    }
                }
            });

            // --- Initial Load ---
            initializeFirebase();
        });
    </script>
</body>
</html>

